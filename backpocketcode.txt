const filteredUsers = useMemo(() => {
  if (!users) return [];

  const q = (searchQuery || '').trim().toLowerCase();

  return users.filter((u) => {
    if (!u || !u._id) return false;

    // Ensure id comparison works even if types differ (ObjectId vs string)
    if (loggedInUser && String(u._id) === String(loggedInUser._id)) return false;

    // If no search query, show all other users
    if (q === '') return true;

    return (u.name || '').toLowerCase().includes(q);
  });
}, [users, searchQuery, loggedInUser]);